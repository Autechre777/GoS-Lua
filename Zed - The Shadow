require('Inspired')
require('IAC')

Config = scriptConfig("Zed", "Zed - The Shadow")
Config.addParam("ksR", "Use R to killsteal", SCRIPT_PARAM_ONOFF, true)
Config.addParam("AutoE", "Use Auto-E", SCRIPT_PARAM_ONOFF, true)
Config.addParam("Combo", "Combo", SCRIPT_PARAM_KEYDOWN, string.byte(" "))
Config.addParam("useW", "Use W", SCRIPT_PARAM_ONOFF, true)
Config.addParam("gabW", "Use W to gabclose", SCRIPT_PARAM_ONOFF, true)

myIAC = IAC()

OnLoop (function(myHero)

local myHeroPos = GetOrigin(myHero)
local target = GetCurrentTarget()
local AD = GetBaseDamage(myHero) + GetBonusDmg(myHero)
Killsteal()

-- R DMG Calc 
	USER = KeyIsDown(82)
	if USER == true then
		StartHP = GetCurrentHP(target)
		-- ArmorTarget = GetArmor(target)
		-- ArmorA = (100/(100+GetArmor(target)))-1
		-- Reduction = math.sqrt(math.pow(ArmorA,2)) + 1
		-- PrintChat("Enemy Starting HP: ".. StartHP)
		-- AD = GetBaseDamage(myHero) + GetBonusDmg(myHero)
		-- PrintChat("Lux Armor: ".. ArmorTarget)
		-- PrintChat("Lux DMG Reduction: ".. Reduction)
		-- PrintChat("AD: ".. AD)
		-- PrintChat("DPS: ".. DPS)
		-- PrintChat("trueDMGr: "..trueDMGr)
	end


	
	EndHP = GetCurrentHP(target)
	
if CanUseSpell(myHero,_R) == READY then
	DrawDmgOverHpBar(target,GetCurrentHP(target),trueDMGr,0,0xff00ff00)
	
elseif GotBuff(target,"zedulttargetmark") == 1 then
	ArmorTarget = GetArmor(target)
	ArmorA = (100/(100+GetArmor(target)))-1
	Reduction = math.sqrt(math.pow(ArmorA,2)) + 1
	extraDMG = StartHP - EndHP
	MarkDMG = CalcDamage(myHero, target, 0, ((0.15*GetCastLevel(myHero,_R) + 0.05) * (Reduction * extraDMG)) + (GetBaseDamage(myHero) + GetBonusDmg(myHero)))
	DrawDmgOverHpBar(target,GetCurrentHP(target),MarkDMG,0,0xff00ff00)
		
	--PrintChat("Mark DMG: ".. MarkDMG)
else
	DrawDmgOverHpBar(target,GetCurrentHP(target),DPS,0,0xff00ff00)
end	

-- Auto E
	if ValidTarget(target, 290) and Config.AutoE then
		CastSpell(_E)
	end 
-- if GotBuff(myHero,"zedwhandler") == 0 then
	-- PrintChat("Cast first Second W is ready!")
-- end

 -- local WStatus = GotBuff(myHero,"zedwhandler")

 -- PrintChat("W Status: "..WStatus)
-- Combo
-- if Config.Combo then

	-- if ValidTarget(target, 1000) then

-- W

-- if Config.useW then
	-- local WPred = GetPredictionForPlayer(myHeroPos,target,GetMoveSpeed(target),250,300,GetCastRange(myHero,_W),290,false,false)
	-- if CanUseSpell(myHero, _W) == READY and WPred.HitChance == 1 and ValidTarget(target, GetCastRange(myHero,_W)) and WStatus == 0 and Config.useW then

		-- DelayAction(function() if WStatus == 0 then
									-- CastSkillShot(_W,WPred.PredPos.x,WPred.PredPos.y,WPred.PredPos.z) end end, 50)
	-- end
-- end						

-- waitTickCount = GetTickCount() + 400 and if waitTickCount > GetTickCount() then return end

--WBuffname = zedwhandler
--Wname = ZedShadow
--WBasename = Shadow
--WObjtype = obj_AI_Minion
--W Spell name = Shadow Swap
-- zedw2

end)

function Killsteal()
       for i,enemy in pairs(GetEnemyHeroes()) do
			
			if CanUseSpell(myHero,_Q) == READY then 
				qDMG = CalcDamage(myHero, enemy, 0, (24*GetCastLevel(myHero,_Q)+21+(0.6*(GetBaseDamage(myHero) + GetBonusDmg(myHero)))))
				qDMGpre = (24*GetCastLevel(myHero,_Q)+21+(0.6*(GetBaseDamage(myHero) + GetBonusDmg(myHero))))
			else qDMG = 0
				 qDMGpre = 0
			end
			
			if CanUseSpell(myHero,_E) == READY then 
				eDMG = CalcDamage(myHero, enemy, 0, (30*GetCastLevel(myHero,_E)+30+(0.8*(GetBaseDamage(myHero) + GetBonusDmg(myHero)))))
				eDMGpre = (30*GetCastLevel(myHero,_E)+30+(0.8*(GetBaseDamage(myHero) + GetBonusDmg(myHero))))
			else eDMG = 0
				 eDMGpre = 0
			end
			
			DPS = qDMG + eDMG
			DPSpre = qDMGpre + eDMGpre
			
			if CanUseSpell(myHero,_R) == READY then
				AADMG = CalcDamage(myHero, enemy, 0, (GetBaseDamage(myHero) + GetBonusDmg(myHero)))
				trueDMGr = CalcDamage(myHero, enemy, 0, (((0.15*GetCastLevel(myHero,_R) + 0.05) * DPSpre ) + (GetBaseDamage(myHero) + GetBonusDmg(myHero)) + AADMG)) + DPSpre
			else trueDMGr = 0
			end
			
            if CanUseSpell(myHero, _R) == READY and ValidTarget(enemy,GetCastRange(myHero,_R)) and Config.ksR and GetCurrentHP(enemy) < trueDMGr then
            CastTargetSpell(enemy, _R)
			StartHP = GetCurrentHP(enemy)
			--PrintChat("StartHP: "..StartHP)
            end
      end
end
