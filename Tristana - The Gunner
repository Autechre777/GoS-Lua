require('Inspired')
require('IAC')

PrintChat("Tristana - The Gunner loaded.")
PrintChat("by Noddy")

ComboConfig = scriptConfig("Tristana", "Tristana - The Gunner")
ComboConfig.addParam("useQ", "Use Q in combo", SCRIPT_PARAM_ONOFF, true)
ComboConfig.addParam("useE", "Use E in combo", SCRIPT_PARAM_ONOFF, true)
ComboConfig.addParam("Combo", "Combo", SCRIPT_PARAM_KEYDOWN, string.byte(" "))
ComboConfig.addParam("ksR", "Use R - KS", SCRIPT_PARAM_ONOFF, true)
ComboConfig.addParam("drawR", "Draw R-Damage", SCRIPT_PARAM_ONOFF, true)
ComboConfig.addParam("ERKS", "Use R if E can kill", SCRIPT_PARAM_ONOFF, true)

myIAC = IAC()

eDMG = 0

OnLoop ( function (myHero)

local myHeroPos = GetOrigin(myHero)
local target = GetTarget(GetCastRange(myHero,_R), DAMAGE_PHYSICAL)

-- Items
local CutBlade = GetItemSlot(myHero,3144)
local bork = GetItemSlot(myHero,3153)

-- BORK & CutBlade
if CutBlade >= 1 and ValidTarget(target,550) and ComboConfig.Combo then
	CastTargetSpell(target, GetItemSlot(myHero,3144))
elseif bork >= 1 and ValidTarget(target,550) and ComboConfig.Combo and (GetMaxHP(myHero) / GetCurrentHP(myHero)) >= 1.25 then 
	CastTargetSpell(target,GetItemSlot(myHero,3153))
end

KSR()

for i,enemy in pairs(GetEnemyHeroes()) do
if CanUseSpell(myHero,_R) == READY then
if GotBuff(enemy,"tristanaechargesound") == 1 then
eDMG = CalcDamage(myHero, enemy, (10*GetCastLevel(myHero,_E)+50+((0.15*(GetCastLevel(myHero,_E))+0.35)*(GetBaseDamage(myHero) + GetBonusDmg(myHero)))+(0.5*GetBonusAP(myHero))) + ((GotBuff(enemy,"tristanaecharge")-1)*(3*GetCastLevel(myHero,_E)+15+((0.045*(GetCastLevel(myHero,_E))+0.105)*(GetBaseDamage(myHero) + GetBonusDmg(myHero)))+(0.15*GetBonusAP(myHero)))), 0 )
elseif GotBuff(enemy,"tristanaechargesound") == 0 then
eDMG = 0
end

if CanUseSpell(myHero,_R) == READY then	
	drRDMG = CalcDamage(myHero, enemy, 0, 100*GetCastLevel(myHero,_R)+ 200 + (1.0*GetBonusAP(myHero)))
elseif CanUseSpell(myHero,_R) == NOTAVAILABLE then
	drRDMG = 0
end

if ValidTarget(enemy,2000) then
	if ComboConfig.drawR and ValidTarget(enemy,2000) and CanUseSpell(myHero,_R) == READY then
		DrawDmgOverHpBar(enemy,GetCurrentHP(enemy),eDMG + CalcDamage(myHero, enemy, 0, 100*GetCastLevel(myHero,_R)+ 200 + (1.0*GetBonusAP(myHero))),0,0xff00ff00)
	end
end

else

if GotBuff(enemy,"tristanaechargesound") == 1 then
eDMG = CalcDamage(myHero, enemy, (10*GetCastLevel(myHero,_E)+50+((0.15*(GetCastLevel(myHero,_E))+0.35)*(GetBaseDamage(myHero) + GetBonusDmg(myHero)))+(0.5*GetBonusAP(myHero))) + ((GotBuff(enemy,"tristanaecharge")-1)*(3*GetCastLevel(myHero,_E)+15+((0.045*(GetCastLevel(myHero,_E))+0.105)*(GetBaseDamage(myHero) + GetBonusDmg(myHero)))+(0.15*GetBonusAP(myHero)))), 0 )
elseif GotBuff(enemy,"tristanaechargesound") == 0 then
eDMG = 0
end
	
	DrawDmgOverHpBar(enemy,GetCurrentHP(enemy),eDMG,0,0xff00ff00)
end
end

if IWalkConfig.Combo then

	if CanUseSpell(myHero,_E) == READY and ComboConfig.useE then
		CastTargetSpell(target,_E)
	end
	if CanUseSpell(myHero,_Q) == READY and ValidTarget(target,850) and ComboConfig.useQ then
		CastSpell(_Q)
	end

end
end)

function KSR()
for i,enemy in pairs(GetEnemyHeroes()) do

if ComboConfig.ERKS then
if GotBuff(enemy,"tristanaechargesound") == 1 then
eDMG = CalcDamage(myHero, enemy, (10*GetCastLevel(myHero,_E)+40+((0.15*(GetCastLevel(myHero,_E))+0.35)*(GetBaseDamage(myHero) + GetBonusDmg(myHero)))+(0.5*GetBonusAP(myHero))) + ((GotBuff(enemy,"tristanaecharge")-1)*(3*GetCastLevel(myHero,_E)+15+((0.045*(GetCastLevel(myHero,_E))+0.105)*(GetBaseDamage(myHero) + GetBonusDmg(myHero)))+(0.15*GetBonusAP(myHero)))), 0 )
elseif GotBuff(enemy,"tristanaechargesound") == 0 then
eDMG = 0
end
end
	if CanUseSpell(myHero,_R) == READY and ComboConfig.ksR and ValidTarget(enemy,GetCastRange(myHero,_R)) then
		rDMG = CalcDamage(myHero, enemy, 0, 100*GetCastLevel(myHero,_R)+ 200 + (1.0*GetBonusAP(myHero)))
			if GetCurrentHP(enemy) < rDMG+eDMG then
				CastTargetSpell(enemy,_R)
			end	
	end		
end
end
