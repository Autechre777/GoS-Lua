require('Inspired')


-- Thanks to:
-----------------------------
-- Deftsu
-- Zypppy
-- Cloud
-- Inspired
-----------------------------

Menu = scriptConfig("Diana", "The Moonwalker")
Menu.addParam("useQ", "Use Q in combo", SCRIPT_PARAM_ONOFF, true)
Menu.addParam("useW", "Use W in combo", SCRIPT_PARAM_ONOFF, true)
Menu.addParam("useE", "Use E in combo", SCRIPT_PARAM_ONOFF, true)
Menu.addParam("useR", "Use R in combo", SCRIPT_PARAM_ONOFF, true)
Menu.addParam("ksR", "Use R to killsteal", SCRIPT_PARAM_ONOFF, true)
Menu.addParam("combo", "Combo", SCRIPT_PARAM_KEYDOWN, string.byte(" "))
Menu.addParam("escape", "Escape to mouse position", SCRIPT_PARAM_KEYDOWN, string.byte("A"))

Menu.addParam("gapW", "Use W agains gapcloser", SCRIPT_PARAM_ONOFF, true)
Menu.addParam("gapE", "Use E agains gapcloser", SCRIPT_PARAM_ONOFF, true)

Menu.addParam("DrawQ", "Draw Q range", SCRIPT_PARAM_ONOFF, true)
Menu.addParam("DrawW", "Draw W range", SCRIPT_PARAM_ONOFF, false)
Menu.addParam("DrawE", "Draw E range", SCRIPT_PARAM_ONOFF, false)
Menu.addParam("DrawR", "Draw R range", SCRIPT_PARAM_ONOFF, false)

--Menu.addParam("DrawRDMG", "Draw R damage on enemies hpbar", SCRIPT_PARAM_ONOFF, true)

OnLoop(function(myHero)


local myHeroPos = GetOrigin(myHero)
local target = GetCurrentTarget()
local mymouse = GetMousePos()
local QPred = GetPredictionForPlayer(GetOrigin(GetMyHero()), target, GetMoveSpeed(target),2000, 250, 830, 150, false, true)

-- Drawings

	if CanUseSpell(myHero, _Q) == READY and Menu.DrawQ then
		DrawCircle(myHeroPos.x,myHeroPos.y,myHeroPos.z,GetCastRange(myHero,_Q),3,100,ARGB(0,0,200,15))
	end

	if CanUseSpell(myHero, _W) == READY and Menu.DrawW then
		DrawCircle(myHeroPos.x,myHeroPos.y,myHeroPos.z,GetCastRange(myHero,_W),3,100,ARGB(0,0,200,15))
	end

	if CanUseSpell(myHero, _E) == READY and Menu.DrawE then
		DrawCircle(myHeroPos.x,myHeroPos.y,myHeroPos.z,GetCastRange(myHero,_E),3,100,ARGB(0,0,200,15))
	end

	if CanUseSpell(myHero, _R) == READY and Menu.DrawR then
		DrawCircle(myHeroPos.x,myHeroPos.y,myHeroPos.z,GetCastRange(myHero,_R),3,100,ARGB(0,0,200,15))
	end

-- DMG Drawings

--	if CanUseSpell(myHero, _R) == READY and Menu.DrawRDMG then
--		DrawDmgOverHpBar(myHero,GetCurrentHP(myHero),3,100,ARGB(0,0,200,15))
--	end

-- Escape

	if Menu.escape then
		if CanUseSpell(myHero,_Q) == READY and CanUseSpell(myHero,_R) == READY then
			CastSkillShot(_Q,mymouse.x,mymouse.y,mymouse.z)
			CastTargetSpell(_R,mymouse.x,mymouse.y,mymouse.z)

			elseif CanUseSpell(myHero,_R) == READY and CanUseSpell(myHero,_Q) == NOTAVAILABLE then
				CastTargetSpell(_R,mymouse.x,mymouse.y,mymouse.z)

		end
	end

-- Anti Gapcloser

	if Menu.gapW then
		AddGapcloseEvent(_W, 200, false)
	end

	if Menu.gapE then
		AddGapcloseEvent(_E, 250, false)
	end


		if Menu.combo then
-- RQ-Combo 2.0
	    	if CanUseSpell(myHero, _R) == READY and CanUseSpell(myHero, _Q) == READY and Menu.useQ and Menu.useR then

						if QPred.HitChance == 1 and CanUseSpell(myHero, _Q) == READY and Menu.useQ then
							CastSkillShot(_Q, QPred.PredPos.x, QPred.PredPos.y, QPred.PredPos.z)
								if ValidTarget(target, GetCastRange(myHero, _R)) then
									CastTargetSpell(target,_R)
								end
						end
			end

-- RQ-Combo
--	    	if CanUseSpell(myHero, _R) == READY and CanUseSpell(myHero, _Q) == READY and Menu.useR then
--
--				if ValidTarget(target, GetCastRange(myHero, _R)) then
--					CastTargetSpell(target,_R)
--						if QPred.HitChance == 1 and CanUseSpell(myHero, _Q) == READY and Menu.useQ then
--							CastSkillShot(_Q, QPred.PredPos.x, QPred.PredPos.y, QPred.PredPos.z)
--						end
--				end
--			end

-- Basic Combo
-- Q
						if QPred.HitChance == 1 and CanUseSpell(myHero, _Q) == READY and Menu.useQ then
							CastSkillShot(_Q, QPred.PredPos.x, QPred.PredPos.y, QPred.PredPos.z)
						end
-- W
						if ValidTarget(target, 200) and Menu.useW then
							CastSpell(_W)
						end
-- E (Simple Logic)
						if CanUseSpell(myHero, _E) == READY and not IsInDistance(target, 150) and IsInDistance(target, 245) and Menu.useE then
							CastSpell(_E)
						end
-- R (Simple Logic) placeholder for now
						if CanUseSpell(myHero,_R) == READY and GotBuff(target,"moonlight") >= 1 and ValidTarget(target, GetCastRange(myHero,_R)) and Menu.useR then
							CastTargetSpell(target,_R)
						end
		end
-- R KS
						if CanUseSpell(myHero,_R) == READY and ValidTarget(target, GetCastRange(myHero,_R)) and GetCurrentHP(target) < CalcDamage(myHero, target, 0, (60*GetCastLevel(myHero,_R)+40+(0.6*(GetBonusAP(myHero))))) and Menu.ksR then
							CastTargetSpell(target,_R)
						end
	end)
